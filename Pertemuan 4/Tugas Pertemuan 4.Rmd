---
title: "Tugas Pertemuan 4"
author: "Fathoni Sabri"
date: "2025-09-26"
output: html_document
---

# Library
```{r}
library(forecast)
library(TTR)
library(TSA)
library(lmtest)
library(dplyr)
library(dLagM)

```

# White Noise

Menbangkitkan data berpola AR, MA, ARMA, dan banyak proses deret waktu lainnya diawali pembangkitan *white noise*. *White noise* merupakan sederet nilai dari peubah bebas stokastik identik. *white noise* tidak memiliki autokorelasi karena saling bebas dan juga memiliki nilai harapan dan ragam yang sama

*White noise* dibangkitkan dari suatu peubah acak, umumnya peubah acak normal.

```{r}
set.seed(1100)
n <- 300
wn <- rnorm(n)
ts.plot(wn)
```

Dapat terlihat bahwa *white noise* tidak memiliki autokorelasi dari ACF. Perhatikan bahwa lag ke-0 adalah korelasi observasi ke-t dengan dirinya sendiri. Nilai korelasi tersebut pasti 1. Sebagai alternatif, lag pertama di plot ACF dapat ditetapkan sebagai 1 (alih-alih 0) dengan menambahkan argumen `xlim(1, lag akhir)`. Plot tersebut dapat disandingkan bersamaan dengan membuat matriks $1 \times 2$ dengan `par(mfrow = c(1,2))`.

```{r}
par(mfrow = c(1, 2))  # bagi plot jadi 1 baris 2 kolom
acf(wn)  # plot ACF untuk white noise
acf(wn, xlim = c(1, 20))  # plot ACF white noise dibatasi sampai lag 20
```

# Proses MA(2)

Proses MA:

$$
y_{t} = c + e_t + \theta_{1}e_{t-1} + \theta_{2}e_{t-2} + \dots + \theta_{q}e_{t-q} = c+{e_t+\sum_{i=1}^p \theta_ie_{t-i}}
$$

Terlihat bahwa $e_t$, atau *white noise*, berperan penting dalam pembangkitan proses MA.

## Proses Manual

Akan dicoba membangkitkan proses MA paling sederhana, yaitu MA(2) dengan $\theta1 = 0.4$ dan $\theta2 =0.6$ sebanyak 300 observasi dan $c=0$. Karena diperlukan satu nilai awal untuk $e_{t-1}$, masukkan nilai pertama white noise sebagai nilai awal tersebut.

```{r}
set.seed(1100)  # set seed agar hasil sama setiap dijalankan
ma2 <- wn[1:2]  
```

```{r}
for(i in 3:300){ 
   ma2[i] <- wn[i] + 0.4 * wn[i - 1] + 0.6 * wn[i - 2] 
}
ma2
```

## arima.sin

```{r}
set.seed(1100) # supaya hasil simulasi bisa direplikasi
ma2_sim <- arima.sim(list(order=c(0,0,2), ma=c(0.4, 0.6)), n=300) 
ma2_sim
```

## Karakteristik MA(2)

### Plot Time Series

```{r}
par(mfrow = c(1, 2))
ts.plot(ma2, main = "MA(2)", ylab = "Nilai")
ts.plot(ma2_sim, main = "MA(2)", ylab = "Nilai")
```

Berdasarkan plot time series, terlihat bahwa data MA(2) yang dibangkitkan stasioner dalam rataan

### Plot ACF

```{r}
par(mfrow = c(1, 2))
acf(ma2,lag.max = 20)
acf(ma2_sim,lag.max = 20)
```

Berdasarkan plot ACF tersebut, terlihat bahwa plot ACF *cuts off* di lag ketiga

### Plot PACF

```{r}
par(mfrow = c(1, 2))
pacf(ma2)
pacf(ma2_sim)
```

Berdasarkan plot PACF tersebut, terlihat bahwa plot PACF cenderung *tails off* dan membentuk gelombang sinus

### Plot EACF

```{r}
TSA::eacf(ma2)
```

Berdasarkan pola segitiga nol pada plot EACF, terlihat bahwa segitiga nol berada pada ordo AR(1) dan ordo MA(3)

### Scatterplot Antar Lag

#### Korelasi antara $Y_t$ dengan $Y_{t-1}$

```{r}
yt_ma <- ma2[-1]
yt_1_ma <- ma2[-300]

yt_ma_sim <- ma2_sim[-1]
yt_1_ma_sim <- ma2_sim[-300]
```

```{r}
par(mfrow = c(1, 2))
plot(y = yt_ma, x = yt_1_ma)
plot(y = yt_ma_sim, x = yt_1_ma_sim)
```

Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara Yt dengan Yt−1. Hal ini sesuai dengan teori yang ada

```{r}
cor(yt_ma, yt_1_ma)
cor(yt_ma_sim, yt_1_ma_sim)
```
Korelasi antara $Y_t$ dengan $Y_{t−1}$ memiliki nilai $0.4165302$ (manual) atau $0.4167584$ (arima.sim) yang artinya ada hubungan linear yang cukup kuat antara $Y_t$ dengan $Y_{t−1}$.

Korelasi antara $Y_t$ dengan $Y_{t-1}$ dari hasil simulasi mendekati perhitungan teoritis yaitu:

$$
\rho_1 = \frac{-\theta_{1}+\theta_{1}\theta_{2}}{1+(\theta_{1})^2+(\theta_{2})^2} 
= \frac{-(-0.4)+(-0.4)(-0.6)}{1+(-0.4)^2+(-0.6)^2} 
\approx 0.421
$$

#### Korelasi antara $Y_t$ dengan $Y_{t-2}$

```{r}
yt_ma2 <- ma2[-c(1,2)]
yt_2_ma <- ma2[-c(299,300)]

yt_ma2_sim <- ma2_sim[-c(1,2)]
yt_2_ma_sim <- ma2_sim[-c(299,300)]
```

```{r}
par(mfrow = c(1,2))
plot(y = yt_ma2, x = yt_2_ma)
plot(y = yt_ma2_sim, x = yt_2_ma_sim)
```


Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara $Y_t$ dengan $Y_{t-2}$. Hal ini sesuai dengan teori yang ada

```{r}
cor(yt_ma2, yt_2_ma)
cor(yt_ma2_sim, yt_2_ma_sim)
```
Korelasi antara $Y_t$ dengan $Y_{t−2}$ memiliki nilai $0.3288711$ (manual) atau $0.328489$ (arima.sim) yang artinya ada hubungan linear yang cukup kuat antara $Y_t$ dengan $Y_{t−2}$.

Korelasi antara $Y_t$ dengan $Y_{t-2}$ dari hasil simulasi mendekati perhitungan teoritis yaitu:

$$
\rho_2 = \frac{-\theta_{2}}{1+(\theta_{1})^2+(\theta_{2})^2} 
= \frac{-(-0.6)}{1+(-0.4)^2+(-0.6)^2} 
= 0.395
$$

#### Korelasi antara $Y_t$ dengan $Y_{t-3}$

```{r}
yt_ma3 <- ma2[-c(1,2,3)]
yt_3_ma <- ma2[-c(298,299,300)]

yt_ma3_sim <- ma2_sim[-c(1,2,3)]
yt_3_ma_sim <- ma2_sim[-c(298,299,300)]
```

```{r}
par(mfrow = c(1,2))
plot(y = yt_ma3, x = yt_3_ma)
plot(y = yt_ma3_sim, x = yt_3_ma_sim)
```

Berdasarkan scatterplot tersebut, terlihat bahwa cenderung tidak terdapat hubungan antara $Y_t$ dengan $Y_{t-3}$.

```{r}
cor(yt_ma3,yt_3_ma)
cor(yt_ma3_sim, yt_3_ma_sim)
```

Korelasi antara $Y_t$ dengan $Y_{t-3}$ hasil simulasi mendekati teori yang ada yaitu 0.

$$
\rho_k = 0, \quad k > 2
$$

# Proses AR(2)


Proses AR dapat dituliskan sebagai berikut:

$$ y_{t} = c + e_t + \phi_{1}Y_{t-1} + \phi_{2}Y_{t-2} + \dots + \phi_{q}Y_{t-q} = c+{e_t+\sum_{i=1}^p \phi_iY_{t-i}} $$ Terlihat bahwa $Y_t$ berperan penting dalam pembangkitan proses AR.

## Manual

Akan dicoba membangkitkan proses AR paling sederhana, yaitu AR(2) dengan $\phi1 = 0.5$ dan $\phi1 = 0.2$  sebanyak 300 observasi dan $c=0$.



```{r}
set.seed(1017)
n <- length(wn)

ar2 <- numeric(n)

for (i in 3:n){
  ar2[i] <- wn[i] + 0.5 * ar2[i - 1] + 0.2 * ar2[i - 2]
}
ar2
```

## arima.sim

Selain menggunakan cara di atas, pembangkitan proses AR dapat dilakukan dengan fungsi `arima.sim()` sebagai berikut.

```{r}
ar2_sim <- arima.sim(list(order=c(2,0,0), ar=c(0.5,0.2)), n=300)
ar2_sim
```

## Karakteristik AR(2)

### Plot Time Series

```{r}
par(mfrow = c(1,2))
ts.plot(ar2)
ts.plot(ar2_sim)
```

Berdasarkan plot time series tersebut terlihat bahwa data cenderung stasioner pada rataan

### Plot ACF

```{r}
par(mfrow = c(1,2))
acf(ar2)
acf(ar2_sim)
```

Berdasarkan plot ACF tersebut terlihat bahwa plot ACF cenderung *tails off* 

### Plot PACF

```{r}
par(mfrow = c(1,2))
pacf(ar2)
pacf(ar2_sim)
```

Berdasarkan plot PACF tersebut, terlihat bahwa plot PACF *cuts off*. Pada data yang dibangkitkan secara manula, plot mengalami *cuts off* pada lag kedua, sedangkan pada data yang dibangkitkan menggunakan arima.sim(), plot mengalami *cuts off* pada lag pertama.

### Plot EACF

#### manual
```{r}
TSA::eacf(ar2)
```

Berdasarkan pola segitiga nol pada plot EACF, terlihat bahwa segitiga nol berada pada ordo AR(2) dan ordo MA(1)

#### arima.sim
```{r}
TSA::eacf(ar2_sim)
```
Berdasarkan pola segitiga nol pada plot EACF, terlihat bahwa segitiga nol berada pada ordo AR(1) dan ordo MA(0)

terlihat bahwa plot tersebut bukan membentuk AR(2) melainkan AR(1). Hal ini bisa terjadi karena sinyal lag 2 bisa lemah sehingga estimasi PACF lag 2 tidak signifikan yang mengakibatkan EACF menganggap p = 1.

### Scatterplot Antar Lag

#### Korelasi antara $Y_t$ dengan $Y_{t-1}$

```{r}
yt_ar <- ar2[-1]
yt_1_ar <- ar2[-300]

yt_ar_sim <- ar2_sim[-1]
yt_1_ar_sim <- ar2_sim[-300]
```

```{r}
par(mfrow = c(1,2))
plot(y = yt_ar, x = yt_1_ar)
plot(y = yt_ar_sim, x = yt_1_ar_sim)
```

Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara $Y_t$ dengan $Y_{t-1}$. Hal ini sesuai dengan teori yang ada

```{r}
cor(yt_ar, yt_1_ar)
cor(yt_ar_sim, yt_1_ar_sim)
```
Korelasi antara $Y_t$ dengan $Y_{t−1}$ memiliki nilai $0.598033$ (manual) atau $0.6638093$ (arimma.sim) yang artinya ada hubungan linear yang cukup kuat antara $Y_t$ dengan $Y_{t−1}$.

Korelasi antara $Y_t$ dengan $Y_{t-1}$ dari hasil simulasi mendekati perhitungan teoritis yaitu $\rho_1=\phi^1=0.6$:

$$
\rho_1 = \phi_1 + \phi_1 \phi_2 = 0.5 + (0.5)(0.2) = 0.6
$$

#### Korelasi antara $Y_t$ dengan $Y_{t-2}$

```{r}
yt_ar2 <- ar2[-c(1,2)]
yt_2_ar <- ar2[-c(299,300)]

yt_ar2_sim <- ar2_sim[-c(1,2)]
yt_2_ar_sim <- ar2_sim[-c(299,300)]
```

```{r}
par(mfrow = c(1,2))
plot(y = yt_ar2, x = yt_2_ar)
plot(y = yt_ar2_sim, x = yt_2_ar_sim)
```

Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara $Y_t$ dengan $Y_{t-2}$. Hal ini sesuai dengan teori yang ada

```{r}
cor(yt_ar2, yt_2_ar)
cor(yt_ar2_sim, yt_2_ar_sim)
```
Korelasi antara $Y_t$ dengan $Y_{t−2}$ memiliki nilai $0.4377821$ (manual) atau $0.4667212$ (arima.sim) yang artinya ada hubungan linear yang cukup kuat antara $Y_t$ dengan $Y_{t−2}$.

Korelasi antara $Y_t$ dengan $Y_{t-2}$ dari hasil simulasi mendekati perhitungan teoritis yaitu $\rho_2=\phi^2=0.5$:

$$
\rho_2 = \phi_1 \rho_1 + \phi_2 = 0.5 \cdot 0.6 + 0.2 = 0.5
$$

#### Korelasi antara $Y_t$ dengan $Y_{t-3}$
```{r}
yt_ar3 <- ar2[-c(1,2,3)]
yt_3_ar <- ar2[-c(298,299,300)]

yt_ar3_sim <- ar2_sim[-c(1,2,3)]
yt_3_ar_sim <- ar2_sim[-c(298,299,300)]
```

```{r}
par(mfrow = c(1,2))
plot(y = yt_ar3, x = yt_3_ar)
plot(y = yt_ar3_sim, x = yt_3_ar_sim)
```
Berdasarkan scatterplot tersebut, terlihat bahwa cenderung tidak terdapat hubungan antara $Y_t$ dengan $Y_{t-3}$.

```{r}
cor(yt_ar3,yt_3_ar)
cor(yt_ar3_sim, yt_3_ar_sim)
```
Korelasi antara $Y_t$ dengan $Y_{t−3}$ memiliki nilai $0.2450629$ (manual) atau $0.3163653$ (arima.simm) yang artinya ada hubungan linear yang lemah antara $Y_t$ dengan $Y_{t−3}$.

Korelasi antara $Y_t$ dengan $Y_{t-3}$ dari hasil simulasi mendekati perhitungan teoritis yaitu $\rho_3=\phi^3=0.37$:
$$
\rho_3 = \phi_1 \rho_2 + \phi_2 \rho_1 = 0.5 \cdot 0.5 + 0.2 \cdot 0.6 = 0.37
$$

# Proses AR(2,2)

## Manual

```{r}
set.seed(1100)
n = length(wn)

arma22 = c(1:n)
for (i in 3:n) {
  arma22[i] <- 0.5 * arma22[i - 1] + 0.2 * arma22[i - 2] + wn[i] + 0.4 * wn[i - 1] + 0.6 * wn[i - 2]
}
arma22
```

## arima.sim
Pembangkitan ARMA(p,q) juga dapat dilakukan dengan fungsi `arima.sim` sebagai berikut.

```{r}
arma22_sim <- arima.sim(list(order = c(2,0,2),
                          ar = c(0.5, 0.2),
                          ma = c(0.4, 0.6)),
                          n = 300)
arma22_sim
```

## Karakteristik ARMA(2,2)

### Plot Time Series

```{r}
par(mfrow = c(1, 2))
ts.plot(arma22)
ts.plot(arma22_sim)
```

Berdasarkan plot time series tersebut, terlihat bahwa model ARMA(2,2) cenderung stasioner dalam rataan

### Plot ACF

```{r}
par(mfrow = c(1, 2))
acf(arma22_sim)
acf(arma22)
par(mfrow = c(1, 1))
```

Berdasarkan plot ACF tersebut, terlihat bahwa model ARMA(2,2) hasil simulasi memiliki plot ACF yang *tails off*, sesuai dengan teori yang ada

### Plot PACF

```{r}
par(mfrow = c(1, 2))
pacf(arma22_sim)
pacf(arma22)
par(mfrow = c(1, 1))
```

Berdasarkan plot PACF tersebut, terlihat bahwa model ARMA(2,2) hasil simulasi memiliki plot PACF yang *tails off*, sesuai dengan teori

### Plot EACF

```{r}
TSA::eacf(arma22_sim)
TSA::eacf(arma22)
```

Berdasarkan pola segitiga nol pada plot EACF, terlihat bahwa segitiga nol berada pada ordo AR(1) MA(3) dan ordo AR(2) MA(2).

Hal ini karena EACF adalah metode heuristik dan dengan sampel n=300 dan konfigurasi parameter tertentu, pola sampel ACF/PACF bisa mirip ARMA(1,2). Jadi EACF bisa memberikan kandidat lain.

### Scatterplot Antar Lag

#### Korelasi antara $Y_t$ dengan $Y_{t-1}$

```{r}
yt_arma <- arma22[-1]
yt_1_arma <- arma22[-300]

yt_arma_sim <- arma22_sim[-1]
yt_1_arma_sim <- arma22_sim[-300]
```

```{r}
par(mfrow = c(1,2))
plot(y = yt_arma, x = yt_1_arma)
plot(y = yt_arma_sim, x = yt_1_arma_sim)
```

Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara $Y_t$ dengan $Y_{t-1}$. Hal ini sesuai dengan teori yang ada

```{r}
cor(yt_arma, yt_1_arma)
cor(yt_arma_sim, yt_1_arma_sim)
```
Korelasi antara $Y_t$ dengan $Y_{t−1}$ memiliki nilai $0.8285687$ (manual) atau $0.8384373$ (arima.sim) yang artinya ada hubungan linear yang sangat kuat antara $Y_t$ dengan $Y_{t−1}$.

Korelasi antara $Y_t$ dengan $Y_{t-1}$ dari hasil simulasi mendekati perhitungan teoritis yaitu:


$$
\rho_1 = \frac{(1 - \phi_2)\theta_1 + (\phi_1 - \phi_2)\theta_2 + \phi_1(1 + \theta_1^2 + \theta_2^2)}
{(1 - \phi_2)(1 + \theta_1^2 + \theta_2^2) + 2(\phi_1 - \phi_2)\theta_1\theta_2}
= \frac{(1 - 0.2)(0.4) + (0.5 - 0.2)(0.6) + 0.5(1 + 0.4^2 + 0.6^2)}
{(1 - 0.2)(1 + 0.4^2 + 0.6^2) + 2(0.5 - 0.2)(0.4)(0.6)}
= \frac{1.26}{1.36} \approx 0.926
$$

#### Korelasi antara $Y_t$ dengan $Y_{t-2}$
```{r}
yt_arma2 <- arma22[-c(1,2)]
yt_2_arma <- arma22[-c(299,300)]

yt_arma2_sim <- arma22_sim[-c(1,2)]
yt_2_arma_sim <- arma22_sim[-c(299,300)]
```

```{r}
par(mfrow = c(1,2))
plot(y = yt_arma2, x = yt_2_arma)
plot(y = yt_arma2_sim, x = yt_2_arma_sim)
```
Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara $Y_t$ dengan $Y_{t-1}$. Hal ini sesuai dengan teori yang ada


```{r}
cor(yt_arma2, yt_2_arma)
cor(yt_arma2_sim, yt_2_arma_sim)
```

Korelasi antara $Y_t$ dengan $Y_{t−2}$ memiliki nilai $0.676848$ (manual) atau $0.6843591$ (arima.sim) yang artinya ada hubungan linear yang sangat kuat antara $Y_t$ dengan $Y_{t−2}$.

Korelasi antara $Y_t$ dengan $Y_{t-2}$ dari hasil simulasi sedikit berbeda dengan perhitungan teoritis, yaitu:
$$
\rho_2 = \frac{(\phi_1 + \theta_1\theta_2)(1 - \phi_2) + (\phi_1^2 - \phi_2)(1 + \theta_1^2 + \theta_2^2) + \theta_2(\theta_1 + \phi_1\theta_2)}
{(1 - \phi_2)(1 + \theta_1^2 + \theta_2^2) + 2(\phi_1 - \phi_2)\theta_1\theta_2}
= \frac{(0.5 + 0.4 \times 0.6)(0.8) + (0.5^2 - 0.2)(1 + 0.4^2 + 0.6^2) + 0.6(0.4 + 0.5 \times 0.6)}
{(1-0.2)(1 + 0.4^2 + 0.6^2) + 2(0.5 - 0.2)(0.4)(0.6)}
= \frac{1.088}{1.36} = 0.8
$$

#### Korelasi antara $Y_t$ dengan $Y_{t-3}$

```{r}
yt_arma3 <- arma22[-c(1,2,3)]
yt_3_arma <- arma22[-c(298,299,300)]

yt_arma3_sim <- arma22_sim[-c(1,2,3)]
yt_3_arma_sim <- arma22_sim[-c(298,299,300)]
```

```{r}
par(mfrow = c(1,2))
plot(y = yt_arma3, x = yt_3_arma)
plot(y = yt_arma3_sim, x = yt_3_arma_sim)
```
Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara $Y_t$ dengan $Y_{t-3}$.

```{r}
cor(yt_arma3, yt_3_arma)
cor(yt_arma3_sim, yt_3_arma_sim)
```
Korelasi antara $Y_t$ dengan $Y_{t−3}$ memiliki nilai $0.4199179$ (manual) atau $0.4199179$ (arima.sim) yang artinya ada hubungan linear yang cukup kuat antara $Y_t$ dengan $Y_{t−3}$.


Korelasi antara $Y_t$ dengan $Y_{t-3}$ dari hasil simulasi sedikit berbeda dengan perhitungan teoritis, yaitu:
$$
\rho_3 = \phi_1 \rho_2 + \phi_2 \rho_1
= (0.5)(0.8) + (0.2)(0.926)
= 0.5852
$$